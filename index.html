<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Happy Birthday E-Card</title>
<style>
/* Reset */
* { margin:0; padding:0; box-sizing:border-box; font-family: 'Arial', sans-serif; }
body, html { width:100%; height:100%; overflow:hidden; background:#000; }

/* Common page style */
.page { 
    width:100%; height:100%;
    position:absolute; top:0; left:0;
    display:flex; justify-content:center; align-items:center; flex-direction:column;
    transition: opacity 0.8s ease;
    background: url("images/background.png") no-repeat center center/cover;
}
.page.hidden { display: none; opacity: 0; pointer-events: none; }

/* Start Page */
#startPage { z-index:20; color:white; text-align:center; }
.start-btn {
    background:#ff4081; color:white; padding:15px 30px;
    border:none; border-radius:10px; font-size:20px;
    cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.4);
}
.start-btn:hover { background:#e91e63; }

/* Cake Page */
#page0 { z-index: 15; flex-direction: column; }
.cake-container { position: relative; width:300px; height:300px; }
.cake-img { width:100%; height:auto; border-radius: 20px; }
.candle {
  position: absolute;
  width: 10px; height: 40px;
  background: #fff; border-radius: 3px;
}
.flame {
  width: 15px; height: 25px;
  background: orange;
  border-radius: 50% 50% 40% 40%;
  margin: 0 auto;
  animation: flicker 0.3s infinite alternate;
}
@keyframes flicker {
  from { transform: scale(1) translateY(0); opacity: 1; }
  to   { transform: scale(1.1) translateY(-2px); opacity: 0.9; }
}
.blown .flame { animation: fadeOut 1s forwards; }
@keyframes fadeOut { to { opacity:0; transform: scale(0.2); } }

/* Envelope Page */
#page1 { z-index: 10; }
.animated-envelope {
    width: 100vw; height: 100vh;
    object-fit: cover;
}
.animated-envelope.opening { animation: envelopeOpen 0.8s forwards; }
@keyframes envelopeOpen {
    0% { transform: scale(1) rotate(0deg); }
    50% { transform: scale(1.05) rotate(3deg); }
    100% { transform: scale(1.2) rotate(0deg); opacity: 0; }
}

/* Other Pages */
#page2, #page3, #page4 { z-index: 5; color:white; text-align:center; font-size:2em; }
</style>
</head>
<body>

<!-- Start Page -->
<div class="page" id="startPage">
  <h1>🎉 Welcome 🎉</h1>
  <p>Click below to begin...</p>
  <button class="start-btn" onclick="initApp()">Start</button>
</div>

<!-- Cake Page -->
<div class="page hidden" id="page0">
    <h1 style="color:white; text-shadow:2px 2px 8px black;">Make a Wish 🎂</h1>
    <div class="cake-container" id="cake">
        <img src="images/cake.png" class="cake-img" alt="Birthday Cake">
        <div id="candles"></div>
    </div>
    <p style="color:white; margin-top:20px; text-shadow:1px 1px 3px black;">
        Blow on the candles to put them out! 🎤
    </p>
</div>

<!-- Envelope Page -->
<div class="page hidden" id="page1">
    <img src="images/envelope.gif" class="animated-envelope" id="envelope" alt="Envelope Animation">
</div>

<!-- Page 2 -->
<div class="page hidden" id="page2">
    <h2>🎁 Surprise Awaits! 🎁</h2>
</div>

<!-- Page 3 -->
<div class="page hidden" id="page3">
    <h2>💖 Forever Together 💖</h2>
</div>

<!-- Page 4 -->
<div class="page hidden" id="page4">
    <h2>🎊 Happy 17th Birthday! 🎊</h2>
</div>

<audio id="happySong">
  <source src="happy.mp3" type="audio/mpeg">
</audio>

<script>
const candlesDiv = document.getElementById("candles");
for(let i=0; i<17; i++){
    const c = document.createElement("div");
    c.className = "candle";
    c.style.left = (20 + i*15) % 250 + "px"; 
    c.style.top = 30 + (i%2)*5 + "px";
    const flame = document.createElement("div");
    flame.className = "flame";
    c.appendChild(flame);
    candlesDiv.appendChild(c);
}

const cake = document.getElementById("cake");
const happySong = document.getElementById("happySong");

// Start app after button click
function initApp(){
    document.getElementById("startPage").classList.add("hidden");
    document.getElementById("page0").classList.remove("hidden");

    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const mic = audioContext.createMediaStreamSource(stream);
        const analyser = audioContext.createAnalyser();
        mic.connect(analyser);
        analyser.fftSize = 512;
        const dataArray = new Uint8Array(analyser.frequencyBinCount);

        function detectBlow(){
            analyser.getByteFrequencyData(dataArray);
            let volume = dataArray.reduce((a,b)=>a+b) / dataArray.length;
            if(volume > 60){
                blowCandles();
                return;
            }
            requestAnimationFrame(detectBlow);
        }
        detectBlow();
    });
}

function blowCandles(){
    cake.classList.add("blown");
    happySong.play().catch(()=>console.log("Autoplay blocked"));
    setTimeout(()=>{
        document.getElementById("page0").classList.add("hidden");
        document.getElementById("page1").classList.remove("hidden");
        startEnvelopeAnimation();
    }, 4000);
}

function startEnvelopeAnimation(){
    const envelope = document.getElementById("envelope");
    envelope.classList.add("opening");
    setTimeout(()=>{
        document.getElementById("page1").classList.add("hidden");
        document.getElementById("page2").classList.remove("hidden");
        setTimeout(()=>{
            document.getElementById("page2").classList.add("hidden");
            document.getElementById("page3").classList.remove("hidden");
            setTimeout(()=>{
                document.getElementById("page3").classList.add("hidden");
                document.getElementById("page4").classList.remove("hidden");
            }, 4000);
        }, 4000);
    }, 2500);
}
</script>
</body>
</html>
