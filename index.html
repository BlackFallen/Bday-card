<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Happy Birthday E-Card</title>
<style>
/* Reset */
* { margin:0; padding:0; box-sizing:border-box; font-family: 'Arial', sans-serif; }
body, html { width:100%; height:100%; overflow:hidden; background: #f0f0f0; }

/* Common page style */
.page { 
    width:100%; height:100%; position:absolute; top:0; left:0; 
    display:flex; justify-content:center; align-items:center; flex-direction:column; 
    transition: opacity 0.8s ease; 
    background: url("images/background.png") no-repeat center center/cover; 
    padding: 20px;
}
.page.hidden { display:none; opacity:0; pointer-events:none; }

/* Cake Page */
#page0 h1 { color:white; text-shadow:2px 2px 8px black; margin-bottom:20px; }
.cake-container { position:relative; width:300px; }
.cake-img { width:100%; }
.candle { position:absolute; width:6px; height:25px; background:#fff; border-radius:3px; }
.flame { width:10px; height:15px; background:orange; border-radius:50%; position:absolute; top:-15px; left:-2px; animation:flicker 0.2s infinite; }
@keyframes flicker { 0%{transform:scale(1);} 50%{transform:scale(1.2);} 100%{transform:scale(1);} }
.blown .flame { animation:none; opacity:0; }

/* Envelope Page */
#page1 { z-index:10; }
.animated-envelope { width:100vw; height:100vh; object-fit:cover; }
.animated-envelope.opening { animation: envelopeOpen 0.8s forwards; }
@keyframes envelopeOpen { 0%{transform:scale(1) rotate(0deg);} 50%{transform:scale(1.05) rotate(3deg);} 100%{transform:scale(1.2) rotate(0deg); opacity:0;} }

/* White transition overlay */
.transition-overlay {
    position: fixed; top:0; left:0; width:100%; height:100%;
    background:white; z-index:100; opacity:0; pointer-events:none;
    transition: opacity 1s ease;
}
.transition-overlay.active { opacity:1; pointer-events:all; }

/* Page 2 - Happy Birthday */
#page2 { z-index:5; }
#page2 h1 { font-size:5rem; color:yellow; text-shadow: 2px 2px 10px #000; text-align:center; margin-bottom: 2rem; }
.floating-icon { position:absolute; animation: floatAnim 6s ease-in-out infinite alternate; }
.floating-icon.big { width:150px; height:150px; object-fit: contain; }
.floating-icon.small { width:80px; height:80px; object-fit: contain; }
@keyframes floatAnim { 0%{transform:translateY(0px);} 50%{transform:translateY(-20px);} 100%{transform:translateY(0px);} }
.balloon { position:absolute; width:50px; font-size: 2rem; animation: rise linear infinite; }
@keyframes rise { 0%{transform:translateY(100vh);} 100%{transform:translateY(-150px);} }

/* Page 3 - Photo Page */
#page3 { z-index:5; }
#page3 .photo-container { width:537px; height:334px; margin-bottom:20px; display:flex; justify-content:center; align-items:center; }
#page3 img.photo { width:100%; height:100%; border-radius:15px; box-shadow:0 0 25px rgba(0,0,0,0.6); border:3px solid #fff; object-fit: cover; }
#page3 .typing { margin-top:20px; font-size:2rem; border-right:3px solid black; white-space:nowrap; overflow:hidden; color:#333; font-weight: bold; }
#nextBtn { margin-top:30px; padding:15px 35px; font-size:1.2rem; border:none; border-radius:30px;
    background: linear-gradient(45deg,#ff7e5f,#feb47b); cursor:pointer; box-shadow:0 0 15px rgba(0,0,0,0.4); color: white; font-weight: bold; transition: transform 0.3s;}
#nextBtn:hover { transform: scale(1.05); }

/* Letter Page */
#page4 { overflow-y: auto; justify-content: flex-start; padding-top:50px; z-index:5; }
#page4 h2 { font-size:2.5rem; margin-bottom:20px; color: #c0392b; }
#page4 .letter { font-size:1.3rem; max-width:80%; line-height:1.8; color:#333; text-align:center; margin-bottom:30px; }

/* Responsive */
@media (max-width:600px){
    #page2 h1{font-size:3rem;}
    #page3 .photo-container{width:90vw;height:auto;}
    #page3 .typing{font-size:1.5rem;}
    #page4 h2{font-size:2rem;}
    #page4 .letter{font-size:1.1rem; max-width:95%;}
}
.click-instruction { margin-top: 20px; color:white; font-size:1.2rem; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }

</style>
</head>
<body>

<!-- White Transition Overlay -->
<div class="transition-overlay" id="transitionOverlay"></div>

<!-- PAGE 0 - Cake -->
<div class="page" id="page0">
    <h1>Make a wish! 🎂</h1>
    <div class="cake-container" id="cake">
        <img src="images/cake.png" class="cake-img">
        <!-- 17 candles example -->
        <div class="candle" style="top:20px; left:20px;"><div class="flame"></div></div>
        <div class="candle" style="top:20px; left:40px;"><div class="flame"></div></div>
        <div class="candle" style="top:20px; left:60px;"><div class="flame"></div></div>
        <!-- add more candles as needed up to 17 -->
    </div>
    <div class="click-instruction">Blow into your mic to blow the candles!</div>
</div>

<!-- PAGE 1 - Envelope -->
<div class="page hidden" id="page1">
    <img src="images/envelope.gif" id="envelope" class="animated-envelope" alt="Animated Envelope">
</div>

<!-- PAGE 2 - Happy Birthday -->
<div class="page hidden" id="page2">
    <h1>🎉 HAPPY BIRTHDAY 🎂</h1>
    <img src="images/bear1.png" class="floating-icon big" style="top:50px; left:50px;">
    <img src="images/flower1.png" class="floating-icon small" style="top:150px; right:100px;">
    <img src="images/flower2.png" class="floating-icon small" style="top:250px; left:200px;">
    <img src="images/bear2.png" class="floating-icon small" style="bottom:50px; right:50px;">
    <div class="balloon" style="left:100px; animation-duration:8s;">🎈</div>
    <div class="balloon" style="left:300px; animation-duration:6s;">🎈</div>
    <div class="balloon" style="left:500px; animation-duration:7s;">🎈</div>
    <div class="click-instruction">Click anywhere to continue</div>
</div>

<!-- PAGE 3 - Photo Page -->
<div class="page hidden" id="page3">
    <div class="photo-container">
        <img src="images/photo.png" class="photo" alt="Your Photo">
    </div>
    <div class="typing" id="typingPhoto"></div>
    <img src="images/bear3.png" class="floating-icon small" style="bottom:50px; left:50px;">
    <button id="nextBtn">Read Your Special Letter</button>
</div>

<!-- PAGE 4 - Letter Page -->
<div class="page hidden" id="page4">
    <h2>My Letter to You <span>💌</span></h2>
    <div class="letter" id="letter"></div>
    <img src="images/flower1.png" class="floating-icon small" style="top:30px; left:30px;">
    <img src="images/flower2.png" class="floating-icon small" style="top:30px; right:30px;">
    <img src="images/bear1.png" class="floating-icon big" style="bottom:30px; left:50px;">
    <img src="images/bear2.png" class="floating-icon small" style="bottom:50px; right:50px;">
</div>

<!-- Audio -->
<audio id="happy-song" src="happy.mp3" loop></audio>
<audio id="card-song" src="song.mp3" loop></audio>

<script>
// Elements
const page0 = document.getElementById("page0");
const page1 = document.getElementById("page1");
const page2 = document.getElementById("page2");
const page3 = document.getElementById("page3");
const page4 = document.getElementById("page4");
const envelope = document.getElementById("envelope");
const transitionOverlay = document.getElementById("transitionOverlay");
const cake = document.getElementById("cake");

const happySong = document.getElementById("happy-song");
const cardSong = document.getElementById("card-song");

let candlesBlown = false;

// Start happy song on load
window.addEventListener('load', () => {
    happySong.play().catch(e => console.log("Autoplay blocked", e));
});

// Mic blow detection
navigator.mediaDevices.getUserMedia({ audio: true })
.then(stream => {
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const source = audioCtx.createMediaStreamSource(stream);
    const analyser = audioCtx.createAnalyser();
    source.connect(analyser);
    analyser.fftSize = 256;
    const dataArray = new Uint8Array(analyser.frequencyBinCount);

    function detectBlow() {
        analyser.getByteFrequencyData(dataArray);
        const volume = dataArray.reduce((a,b)=>a+b)/dataArray.length;
        if(volume > 20 && !candlesBlown){
            candlesBlown = true;
            cake.classList.add("blown");
            happySong.pause();
            setTimeout(() => {
                page0.classList.add("hidden");
                startEnvelope();
            }, 1000);
        }
        requestAnimationFrame(detectBlow);
    }
    detectBlow();
})
.catch(err => console.log("Mic not accessible", err));

// Envelope page and card music
function startEnvelope(){
    page1.classList.remove("hidden");
    envelope.classList.add("opening");
    setTimeout(()=>{ transitionOverlay.classList.add("active"); }, 500);
    setTimeout(()=>{
        page1.classList.add("hidden");
        page2.classList.remove("hidden");
        transitionOverlay.classList.remove("active");
        cardSong.play().catch(e=>console.log("Autoplay blocked"));
    }, 2500);
}

// Click page2 -> show page3
page2.addEventListener("click", ()=>{
    page2.classList.add("hidden");
    page3.classList.remove("hidden");
    typeWriterPhoto();
});

// Typing animation for photo page
const typingPhoto = document.getElementById("typingPhoto");
let iPhoto = 0;
function typeWriterPhoto(){
    const text = "You're my favorite person! 💖";
    if(iPhoto<text.length){
        typingPhoto.innerHTML += text.charAt(iPhoto);
        iPhoto++;
        setTimeout(typeWriterPhoto,120);
    }
}

// Photo page button -> Letter page
document.getElementById("nextBtn").addEventListener("click", ()=>{
    page3.classList.add("hidden");
    page4.classList.remove("hidden");
    typeLetter();
});

// Letter page typing
const letter = document.getElementById("letter");
const letterLines = [
    "Uhmmmmm uhmmm you r the soul straight from a fairy tale 🎀💎",
    "The costliest gem I own, my muffin my cupcake 🧁",
    "Mera aawwjwjyeyevsjsks bear 💖 ahhhhhhhh",
    "Ryt now I just want to !!!!!!! iffff uk uk !!",
    "",
    "It took 11 years to be friends 🌝🛐 it was meant to be !!!!",
    "And I legit don't know how u fell for me 😁",
    "Hehe ik I'm soo good 😌 jokes apart !",
    "",
    "Messages txts can't express the feeling I feel for youh!",
    "I wish the time should pause when I'm with you, like just us !!!!",
    "Like Ig I have never waited for something that too very concentrated",
    "kinda until it was waiting for you !!",
    "",
    "Like the aim was to just love you from afar coz I didn't want",
    "our friendship to spoil coz of my dumb confession !!!",
    "It's the universe thing okie !!",
    "IT WILL BE FROM ME TO YOU IN EVERY UNIVERSE !!!!",
    "",
    "MWAHHHHHHHHHHH 💗"
];
let currentLine = 0;
function typeLetter(){
    if(currentLine < letterLines.length){
        let line = letterLines[currentLine];
        let charIndex = 0;
        function typeChar(){
            if(charIndex<line.length){
                letter.innerHTML += line.charAt(charIndex);
                charIndex++;
                setTimeout(typeChar,50);
            } else{
                letter.innerHTML += "<br>";
                currentLine++;
                setTimeout(typeLetter,400);
            }
        }
        typeChar();
    }
}
</script>
</body>
</html>
